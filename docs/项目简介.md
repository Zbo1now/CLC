# 项目简介

CampusCoin 是一个面向校内团队的资源与虚拟币管理系统，覆盖“工位租赁、设备分钟计费租用、器材日计费借用、场地小时短租、活动/值班/成果审核与发币、流水与余额管理、后台资源管理”等核心场景。

## 技术栈

### 后端
- **语言/框架**：Java、Spring Boot
- **持久层**：MyBatis（注解 SQL + 分页/脚本）
- **数据库**：MySQL 8+
- **定时任务**：Spring Scheduling（`@Scheduled`）
- **事务**：Spring `@Transactional`
- **日志**：SLF4J（部分模块仍存在 `java.util.logging`，建议后续统一）

### 前端
- **H5/移动端**：uni-app（Vue）
- **后台管理端**：Vue 3 + Element Plus + Axios

## 模块划分（核心业务）

### 团队与会话
- **团队注册/登录**：团队密码哈希存储，登录后建立会话（HttpSession + 自定义 Session 头传递兜底）。
- **余额与流水**：团队余额在 `teams.balance` 维护，所有收支写入 `transactions`，并带 `balance_after` 快照与业务关联字段（`ref_type/ref_id`）。

### 工位租赁（Workstation）
- 按月计费，支持租赁与续租，按团队维度维护有效租约。

### 设备租用（DeviceBooking）
- **计费方式**：按分钟计费（费率为“币/小时”）。
- **结算策略**：预约预扣 + 结束按实际使用结算，多退少补（当前为“只退不补”的策略上限）。
- **状态流转**：定时任务辅助 `RESERVED -> IN_USE -> FINISHED` 自动流转。

### 器材借用（EquipmentLoan）
- **计费方式**：按天计费（费率为“币/天”），支持数量（`quantity`）> 1 与库存字段联动（`available_quantity`）。
- **状态机**：`PENDING -> APPROVED -> BORROWED -> RETURNED`，并支持 `CANCELLED/REJECTED/EXPIRED`。
- **结算策略**：申请预扣；提前归还退款；超期归还补扣；拒绝/取消/过期退款并写流水。
- **定时任务**：PENDING 超过 24 小时自动过期（未到开始日期才处理）。

### 场地短租（VenueBooking）
- **计费方式**：按小时计费（仅支持整点整小时，避免计费歧义）。
- **状态机**：`BOOKED -> IN_USE -> COMPLETED`，以及 `CANCELLED/AUTO_CANCELLED`。
- **规则**：
  - 开始前可取消并退款；
  - 开始后 10 分钟未确认自动取消（不退款）；
  - 到结束时间强制结束（防止超时占用）。

### 后台管理（Admin）
- **资源管理**：统一管理工位/设备/器材/场地的增删改与维护状态。
- **审核与运营**：成果审核、活动参与、值班确认、团队管理、流水查看等。
- **鉴权**：后台登录接口建立会话，由拦截器统一校验。

## 数据表概览（核心）
- `teams`：团队账号与余额
- `transactions`：虚拟币流水（含余额快照与关联信息）
- `devices` / `device_bookings`：设备与预约使用记录
- `equipments` / `equipment_loans`：器材与借用申请记录
- `venues` / `venue_bookings`：场地与短租预约记录
- `workstations` / `workstation_leases`：工位与租赁记录
- `admin_users`：后台管理员账号

## 运行与部署（概览）
- **运行环境**：JDK 8+（建议 11/17）、MySQL 8+、（可选）外部 Tomcat 9/10
- **配置**：`src/main/resources/application.yml`
- **部署形态**：
  - WAR 部署到外部 Tomcat（项目当前文档默认方式）
  - 或改造为 Spring Boot Jar 自启动（更便于云上部署与运维）

## 备注
- 本文档为项目整体概览，不包含接口级细节；接口与交互规范建议单独维护在专门的 API 文档中。
